<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>소율이 긁긁권</title>
  <style>
    body { 
      background: linear-gradient(135deg, #ffe4b5, #ffd700); 
      text-align: center; 
      margin: 0; 
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    h1 {
      color: #8b4513;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    #scratch-container { 
      width: 320px; 
      height: 320px; 
      margin: 20px auto;
      position: relative;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      border-radius: 15px;
      overflow: hidden;
    }
    
    canvas { 
      border: 4px solid #d1a54f; 
      border-radius: 10px;
      cursor: crosshair;
    }
    
    .instructions {
      margin-top: 20px;
      color: #8b4513;
      font-size: 1.2em;
      font-weight: bold;
    }
    
    .prize-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2em;
      font-weight: bold;
      color: #ff6b6b;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      z-index: 1;
    }
  </style>
</head>
<body>
  <h1>🎉 소율이 긁긁권 🎉</h1>
  <div id="scratch-container">
    <div class="prize-text">🎊 대박! 🎊<br>🎁 선물 당첨! 🎁</div>
  </div>
  <div class="instructions">
    마우스나 손가락으로 긁어보세요!
  </div>

  <script>
    class ScratchCard {
      constructor(container, options) {
        this.container = typeof container === 'string' ? document.querySelector(container) : container;
        this.options = {
          width: options.containerWidth || 320,
          height: options.containerHeight || 320,
          scratchType: options.scratchType || 'spray',
          clearZoneRadius: options.clearZoneRadius || 30,
          percentToFinish: options.percentToFinish || 50,
          callback: options.callback || (() => {}),
          ...options
        };
        
        this.canvas = null;
        this.ctx = null;
        this.isDrawing = false;
        this.scratchedPixels = 0;
        this.totalPixels = 0;
        this.finished = false;
      }
      
      init() {
        this.createCanvas();
        this.drawCoverLayer();
        this.attachEvents();
        this.totalPixels = this.options.width * this.options.height;
      }
      
      createCanvas() {
        this.canvas = document.createElement('canvas');
        this.canvas.width = this.options.width;
        this.canvas.height = this.options.height;
        this.ctx = this.canvas.getContext('2d');
        this.container.appendChild(this.canvas);
      }
      
      drawCoverLayer() {
        const gradient = this.ctx.createLinearGradient(0, 0, this.options.width, this.options.height);
        gradient.addColorStop(0, '#c0c0c0');
        gradient.addColorStop(0.5, '#silver');
        gradient.addColorStop(1, '#a0a0a0');
        
        this.ctx.fillStyle = gradient;
        this.ctx.fillRect(0, 0, this.options.width, this.options.height);
        
        this.ctx.fillStyle = 'rgba(255,255,255,0.3)';
        for(let i = 0; i < 100; i++) {
          this.ctx.beginPath();
          this.ctx.arc(
            Math.random() * this.options.width,
            Math.random() * this.options.height,
            Math.random() * 2,
            0,
            Math.PI * 2
          );
          this.ctx.fill();
        }
        
        this.ctx.fillStyle = '#666';
        this.ctx.font = 'bold 20px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.fillText('긁어보세요!', this.options.width / 2, this.options.height / 2 - 20);
        this.ctx.fillText('🪙 💰 🪙', this.options.width / 2, this.options.height / 2 + 20);
      }
      
      attachEvents() {
        this.canvas.addEventListener('mousedown', this.startScratch.bind(this));
        this.canvas.addEventListener('mousemove', this.scratch.bind(this));
        this.canvas.addEventListener('mouseup', this.stopScratch.bind(this));
        this.canvas.addEventListener('mouseleave', this.stopScratch.bind(this));
        
        this.canvas.addEventListener('touchstart', this.handleTouch.bind(this));
        this.canvas.addEventListener('touchmove', this.handleTouch.bind(this));
        this.canvas.addEventListener('touchend', this.stopScratch.bind(this));
      }
      
      handleTouch(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = this.canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        
        const mockEvent = { offsetX: x, offsetY: y };
        
        if (e.type === 'touchstart') {
          this.startScratch(mockEvent);
        } else if (e.type === 'touchmove') {
          this.scratch(mockEvent);
        }
      }
      
      startScratch(e) {
        this.isDrawing = true;
        const rect = this.canvas.getBoundingClientRect();
        const x = e.offsetX || e.clientX - rect.left;
        const y = e.offsetY || e.clientY - rect.top;
        
        this.ctx.globalCompositeOperation = 'destination-out';
        this.ctx.beginPath();
        this.ctx.arc(x, y, this.options.clearZoneRadius, 0, Math.PI * 2, false);
        this.ctx.fill();
        
        this.updateProgress();
      }
      
      scratch(e) {
        if (!this.isDrawing || this.finished) return;
        
        const rect = this.canvas.getBoundingClientRect();
        const x = e.offsetX || e.clientX - rect.left;
        const y = e.offsetY || e.clientY - rect.top;
        
        this.ctx.globalCompositeOperation = 'destination-out';
        this.ctx.beginPath();
        this.ctx.arc(x, y, this.options.clearZoneRadius, 0, Math.PI * 2, false);
        this.ctx.fill();
        
        this.ctx.beginPath();
        this.ctx.arc(x + Math.random() * 10 - 5, y + Math.random() * 10 - 5, this.options.clearZoneRadius * 0.7, 0, Math.PI * 2, false);
        this.ctx.fill();
        
        this.updateProgress();
      }
      
      stopScratch() {
        this.isDrawing = false;
      }
      
      updateProgress() {
        if (this.finished) return;
        
        const imageData = this.ctx.getImageData(0, 0, this.options.width, this.options.height);
        let transparentPixels = 0;
        
        for (let i = 3; i < imageData.data.length; i += 4) {
          if (imageData.data[i] === 0) {
            transparentPixels++;
          }
        }
        
        const percentage = (transparentPixels / this.totalPixels) * 100;
        
        if (percentage >= this.options.percentToFinish) {
          this.finish();
        }
      }
      
      finish() {
        if (this.finished) return;
        
        this.finished = true;
        this.ctx.globalCompositeOperation = 'destination-out';
        this.ctx.fillRect(0, 0, this.options.width, this.options.height);
        
        setTimeout(() => {
          this.options.callback();
        }, 500);
      }
    }
    
    const scratchCard = new ScratchCard('#scratch-container', {
      containerWidth: 320,
      containerHeight: 320,
      clearZoneRadius: 25,
      percentToFinish: 40,
      callback: () => {
        setTimeout(() => {
          alert('🎊 축하합니다! 소율이의 특별한 선물을 받으셨어요! 🎊');
        }, 300);
      }
    });
    
    scratchCard.init();
  </script>
</body>
</html>
